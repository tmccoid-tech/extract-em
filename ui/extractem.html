<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>__MSG_extensionName__</title>
    <link rel="icon" type="image/x-icon" href="/icons/extractem-32px.ico">
    <link rel="stylesheet" type="text/css" media="screen" href="extractem.css">
</head>

<body>
    <div id="flex-container">
        <section id="quickmenu-section" class="hidden">
            <div id="quickmenu-extract-single-div">
                <button type="button" class="quickmenu-button" action="extract-single">__MSG_extensionName__</button>
                __MSG_extractSingleDescription__
            </div>
            <div id="quickmenu-extract-recursive-div" class="hidden">
                <button type="button" class="quickmenu-button" action="extract-recursive">__MSG_extensionName__<br/>(+ __MSG_subfolders__)</button>
                __MSG_extractRecursiveDescription__
            </div>
            <div>
                <button type="button" class="quickmenu-button" action="standard-selection">__MSG_letMeChoose__</button>
                __MSG_standardSelectionDescription__
            </div>
            <div id="quickmenu-footer-div">
                <label id="quickmenu-option-label" class="invisible"><input type="checkbox" id="always-show-quickmenu-checkbox"/> __MSG_alwaysShowQuickMenu__</label>
                <label><input type="checkbox" id="quickmenu-include-embeds-checkbox">Include embeds (inline-attached images)</label>
                <label><input type="checkbox" id="quickmenu-use-file-type-filter-checkbox">Use File Type Filter <button id="quickmenu-file-type-filter-edit-button"></button></label>
            </div>            
        </section>
        <section id="main-section" class="hidden">
            <nav>
                <button type="button" class="nav-button active" context="summary">__MSG_attachmentSummary__</button>
                <button type="button" class="nav-button transparent" context="list" disabled="disabled">__MSG_attachmentList__</button>
                <div id="spinner-logo-div" class="spinner-logo-div">
                    <img id="logo-img" class="logo-img" src="paperclip_logo.png" />
                </div>
            </nav>
            <div class="tab-content-div" context="summary">
                <div>
                    <table id="stats-table" class="omit-embeds">
                        <colgroup>
                            <col span="2" class="folders-column">
                            <col span="3" class="messages-column">
                            <col span="2" class="attachments-column">
                            <col span="1" class="embeds-column">
                        </colgroup>
                        <thead>
                            <tr>
                                <th colspan="2" class="summary-header">__MSG_folders__</th>
                                <th colspan="3" class="summary-header">__MSG_messages__</th>
                                <th colspan="2"  class="summary-header">__MSG_attachments__</th>
                                <th class="summary-header"><label title="Check to include embeds (inline-attached images)"><input type="checkbox" id="include-embeds-checkbox">__MSG_embeds__</label></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="2"><span id="selected-folder-count-span">0</span> / <span id="folder-count-span"></span> __MSG_selected__<br/><span id="processed-folder-count-span">0</span> <span style="text-transform:lowercase;">__MSG_processed__</span></td>
                                <td colspan="3"><span id="summary-selected-message-count-span">0</span> __MSG_selected__<br/></td>
                                <td colspan="2"><span id="summary-selected-attachment-count-span">0</span> __MSG_selected__<br/><span id="summary-selected-attachment-size-span">0 __MSG_bytesLabel__</span></td>
                                <td><span id="summary-selected-embed-count-span">0</span> __MSG_selected__</td>
                            </tr>
                            <tr>
                                <td colspan="2"><br/></td>

                                <td class="summary-header">__MSG_count__</td>
                                <td class="summary-header">__MSG_processed__</td>
                                <td id="with-attachments-label" class="summary-header">__MSG_withAbbrev__<img id="paperclip_char" src="/icons/paper_clip.png" height="20px" width="20px"></td>

                                <td class="summary-header">__MSG_count__</td>
                                <td class="summary-header">__MSG_size__</td>
                                <td class="summary-header">__MSG_count__</td>
                            </tr>
                            <tr id="stats-summary-tr" class="hidden">
                                <td colspan="2"><br/></td>

                                <td id="summary-message-count-span">0</td>
                                <td id="summary-processed-message-count-td">0</td>
                                <td id="summary-attachment-message-count-td">0</td>
                                
                                <td id="summary-attachment-count-span">0</td>
                                <td id="summary-attachment-size-span">0 __MSG_bytesLabel__</td>

                                <td id="summary-embed-count-span" >0</td>
                            </tr>
                        </tbody>
                        <tbody id="stats-summary-tbody">

                        </tbody>
                        <tfoot>
                            <th colspan="2">&nbsp;</th>
                            <th colspan="3"></th>
                            <th colspan="2"></th>
                            <th colspan="1"></th>
                        </tfoot>
                    </table>
                </div>
                <div id="summary-buttons-div">
                    <div>
                        <button type="button" id="discover-attachments-button" class="summary-button">__MSG_discoverAttachments__</button>
                        <progress id="discover-attachments-progress" max="1" value="0"></progress>
                    </div>                    
                    <button type="button" id="extract-all-button" class="summary-button" disabled="disabled">__MSG_extensionName__</button>
                    <button type="button" id="filter-file-type-button" class="summary-button" disabled="disabled">__MSG_filterByFileType__</button>
                    <button type="button" id="reset-summary-button" class="summary-button">__MSG_reset__</button>
                </div>
            </div>
            <div class="tab-content-div hidden" context="list">
                <div id="list-header-div">
                    <div><span id="selected-attachment-count-span">0</span> __MSG_selected__ (<span id="selected-attachment-size-span">0 __MSG_bytesLabel__</span>)</div>
                    <button type="button" id="extract-selected-button">__MSG_extensionName__</button>
                </div>
                <div id="attachment-list-div"></div>
            </div>
        </div>
    </section>

    <div id="filter-overlay" class="modal-overlay hidden">
        <div>
            <!--header-->
        </div>
        <div id="filter-list-div">
<!--
            <div id="filter-documents-header" class="filter-category-header"><label><input type="checkbox" class="filter-category-checkbox" value="_doc"> __MSG_documents__</label></div>
            <div id="filter-documents-header" class="filter-category-header"><label><input type="checkbox" class="filter-category-checkbox" value="_img"> __MSG_images__</label></div>
            <div id="filter-documents-header" class="filter-category-header"><label><input type="checkbox" class="filter-category-checkbox" value="_aud"> __MSG_audio__</label></div>
            <div id="filter-documents-header" class="filter-category-header"><label><input type="checkbox" class="filter-category-checkbox" value="_vid"> __MSG_video__</label></div>
            <div id="filter-documents-header" class="filter-category-header"><label><input type="checkbox" class="filter-category-checkbox" value="_oth"> __MSG_other__</label></div>
-->            
        </div>
    </div>


    <div id="zoom-overlay" class="modal-overlay hidden">
        <img id="zoom-image" title="__MSG_closeZoomMessage__" src="" />
    </div>

    <div id="zip-overlay" class="modal-overlay hidden">
        <div id="zip-panel">
            <div id="zip-panel-header">
                <div id="zip-attachment-context-div">
                    <div id="zip-account-name-label"></div>
                    <div id="zip-attachment-context-span" class="hidden"><span id="zip-folder-name-span"></span><span id="zip-subfolders-span" class="hidden"> (+ __MSG_subfolders__)</span></div>
                </div>
                <div id="zip-spinner-logo-div" class="spinner-logo-div">
                    <img id="zip-logo-img" class="logo-img" src="paperclip_logo.png" />
                </div>
            </div>

            <table id="zip-table">
                <tr>
                    <td>
                        <div class="zip-operation-label">__MSG_discovering__</div>
                        <progress id="immediate-discovery-progress" value="0" max="1"></progress>
                    </td>
                    <td>
                        <div id="immediate-discovery-message-div">
                            <div id="immediate-discovery-progress-message-div"></div>
                            <span id="immediate-discovered-embeds-span">0</span> __MSG_embedsPP__                            
                        </div>
                        <div id="prediscovery-message-div" class="hidden">
                            <div id="discovery-selection-message-div"></div>
                            <div id="embed-discovery-selection-message-div"></div>
                        </div>
                    </td>
                    <td>
                        <div id="discovery-size-label">0 __MSG_bytesLabel__</div>
                        <div>&nbsp;</div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="zip-operation-label">__MSG_packaging__</div>
                        <progress id="packaging-progress" value="0" max="1"></progress>
                        <div><span id="packaging-file-current-span">0</span> __MSG_of__ <span id="packaging-file-total-span">0</span> __MSG_packageFilesSaved__</div>
                    </td>
                    <td>
                        <span id="packaging-current-span">0</span> __MSG_of__ <span id="packaging-total-span">0</span> __MSG_attachmentsPackaged__
                        <div><span id="embed-packaging-current-span">0</span> __MSG_of__ <span id="embed-packaging-total-span">0</span> __MSG_embedsPackaged__</div>
                    </td>
                    <td>
                        <span id="packaging-size-span">0 __MSG_bytesLabel__</span>
                        <div><span id="embed-packaging-size-span">0 __MSG_bytesLabel__</span></div>
                    </td>
                </tr>
                <tr id="exclusions-row">
                    <td>
                        <div>&nbsp;</div>
                        <div class="zip-operation-label">__MSG_exclusions__</div>
                        <div>&nbsp;</div>
                    </td>
                    <td>
                        <div><span id="preparation-alterations-span">0</span> __MSG_alterationsIdentified__</div>
                        <div><span id="packaging-skipped-span">0</span> __MSG_attachment__ / <span id="embed-duplicate-span">0</span> __MSG_embed__ __MSG_duplicatesOmitted__</div>
                        <div><span id="packaging-error-count-span">0</span> __MSG_errorsEncountered__</div>
                    </td>
                    <td>
                        <div id="duplicates-size-label" class="hidden">0 __MSG_bytesLabel__</div>
                        <div>&nbsp;</div>
                        <div>&nbsp;</div>
                    </td>
                </tr>
            </table>

            <table id="detach-table" class="hidden">
                <tr>
                    <td colspan="3">
                        <div id="zip-detach-panel-body">
                            <div class="zip-operation-label permanently-detach-container"><img class="hazard-image" src="hazard-sign.png" /> __MSG_permanentlyDetach__</div>
                            <div id="detach-warning-message">__MSG_permanentDetachWarning__</div>
                            <div id="detach-action-buttons-div">
                                <button id="proceed-detach-button" class="close-button">__MSG_proceed__</button>
                                <button id="cancel-detach-button" class="close-button">__MSG_cancel__</button>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr id="detach-operation-row" class="hidden">
                    <td>
                        <div class="zip-operation-label">__MSG_permanentlyDetach__</div>
                        <progress id="detachment-progress" value="0" max="1"></progress>
                    </td>
                    <td>
                        <div><span id="permanent-detach-current-span">0</span> __MSG_of__ <span id="permanent-detach-total-span">0</span> __MSG_detached__</div>
                    </td>
                    <td>&nbsp;</td>
                </tr>
            </table>

            <div id="last-filename-div" class="last-filename-div">...</div>

            <div id="save-result-div">
                <div id="save-result-border-div"></div>
                <div class="save-result-content-div">
                    <div class="zip-operation-label">__MSG_result__</div>
                    <span id="save-result-label"></span>
                </div>
                <div class="result-button-container save-result-content-div">
                    <button id="permanently-detach-button" class="permanently-detach-container close-button disablable" disabled="disabled"><img class="hazard-image" src="hazard-sign.png" /> __MSG_permanentlyDetach__</button>
                    <button id="view-report-button" class="close-button">__MSG_viewReport__</button>                       
                    <button id="close-zip-panel-button" class="close-button disablable" disabled="disabled">__MSG_close__</button>
                    <button id="exit-extension-button" class="close-button disablable" disabled="disabled">__MSG_closeAndExit__</button>
                </div>
            </div>

            <div id="detach-result-div" class="hidden">
                <div id="detach-result-border-div"></div>
                <div class="save-result-content-div">
                    <div class="zip-operation-label">__MSG_result__</div>
                    <span id="detach-result-label"></span>
                    <div><span id="detach-error-count-span">0</span> __MSG_errorsEncountered__</div>
                </div>
                <div class="result-button-container save-result-content-div">
                    <button id="detach-view-report-button" class="close-button">__MSG_viewReport__</button>                       
                    <button id="detach-exit-extension-button" class="close-button disablable" disabled="disabled">__MSG_closeAndExit__</button>
                </div>
            </div>

        </div>
    </div>    
    
    <div id="release-notes-overlay" class="modal-overlay hidden">
        <div id="release-notes-close-panel">
            <button type="button" id="close-release-notes-button">Close</button>
            <div class="release-notes-panel hidden" version="1.2.1">
                <h4>__MSG_releaseNotesTitle__ 1.2.1</h4>
                <div class="notice-panel">
                __MSG_rn1_2_1_Notice01__ __MSG_rn1_2_1_Notice02__ __MSG_rn1_2_1_Notice03__
                </div>            
                <h4>__MSG_whatsNew__</h4>
                <ul>
                    <li>__MSG_rn1_2_1_New01__</li>
                    <li>__MSG_rn1_2_1_New02__</li>
                    <li>__MSG_rn1_2_1_New03__</li>
                    <li>__MSG_rn1_2_1_New04__</li>
                </ul>
                <h4>__MSG_whatsFixed__</h4>
                <ul>
                    <li>__MSG_rn1_2_1_Fix01__</li>
                    <li>__MSG_rn1_2_1_Fix02__</li>
                </ul>
            </div>
            <div class="release-notes-panel hidden" version="1.3.1">
                <h4>__MSG_releaseNotesTitle__ 1.3.1</h4>
                <h4>__MSG_whatsNew__</h4>
                <ul>
                    <li>__MSG_rn1_3_1_New01__</li>
                    <li>__MSG_rn1_3_1_New02__</li>
                </ul>
            </div>
            <div class="release-notes-panel hidden" version="1.4.1">
                <h4>__MSG_releaseNotesTitle__ 1.4.1</h4>
                <h4>__MSG_whatsNew__</h4>
                <ul>
                    <li>__MSG_rn1_4_1_New01__</li>
                </ul>
            </div>
        </div>        
    </div>

    <template id="folder-stats-template">
        <tr class="message-stats-tr">
            <td><input type="checkbox" class="folder-checkbox" checked="checked" /></td>
            <td class="folder-td"><span class="spacer"></span><button type="button" class="folder-selector-button"></button></td>

            <td class="message-count-td">0</td>
            <td class="processed-message-count-td">0</td>
            <td class="attachment-message-count-td">0</td>

            <td class="attachment-count-td">0</td>
            <td class="attachment-size-td"></td>

            <td class="embed-count-td">0</td>
        </tr>
    </template>

    <template id="attachment-grouping-header-template">
        <div class="attachment-grouping-header"><label><input type="checkbox" class="attachment-grouping-checkbox" checked="checked" /> <span class="grouping-key-span"></span></label></div>
    </template> 
    
    <template id="attachment-panel-template">
        <div class="attachment-panel">
            <input type="checkbox" class="attachment-checkbox" message-id="" part-name="" file-size="" timestamp="" extension="" isEmbed="" checked="checked" />
            <div class="extension-label"></div>
            <div class="file-name-label"></div>
            <div class="author-label"></div>
            <div class="subject-label"></div>
            <div class="file-size-label"></div>
            <div class="message-date-label"></div>
            <div class="preview-wrapper">
                <img class="preview-image hidden" alt="" />
            </div>
        </div>
    </template>

    <template id="report-style-template">
        <style>
            .hidden {
                display: none;
            }

            body {
                padding: 12px;
                font-family: Calibri;
            }

            .report-logo {
                float: left;
                margin-right: 8px;
            }

            .summary-table td:nth-child(even) {
                width: 48px;
                text-align: right;
                padding-right: 32px;
            }

            .list-table {
                width: 80%;
                max-width: 1000px;
                margin-top: 16px;
            }

            .list-table h3 {
                background-color: rgba(255, 228, 196, 0.369);
                margin-bottom: 0px;
                padding: 8px;
            }

            .list-table-item-container {
                display: grid;
                grid-template-columns: 48px 1fr 160px;
                grid-template-areas:
                    "seq filename   filesize"
                    "seq author     date"
                    "seq subject    time"
                    "seq special    special"
                ;
                padding-bottom: 2px;
                border-bottom: solid 1px lightgray;
            }

            .sequence-number {
                grid-area: seq;
            }

            .filename-label {
                grid-area: filename;
                font-weight: bold;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .file-size-label {
                grid-area: filesize;
                justify-self: end;
            }

            .author-label {
                grid-area: author;
                padding-left: 16px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .message-date-label {
                grid-area: date;
                justify-self: end;
            }

            .subject-label {
                grid-area: subject;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                padding-left: 16px;
            }

            .message-time-label {
                grid-area: time;
                justify-self: end;
            }

            .special-message-label {
                grid-area: special;
                padding-left: 16px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .filename-row {
                background-color: rgba(192, 192, 192, .25);                
                text-align: center;
            }

        </style>
    </template>

    <template id="report-template">
        <div>
            <img class="report-logo">
            <h2>__MSG_extensionName__ __MSG_summaryForDate__ <span class="current-datetime-label"></span></h2>

            <table class="summary-table">
                <tr>
                    <td>__MSG_packageFileCount__:</td>
                    <td class="package-file-count-label">0</td>
                    <td>__MSG_previouslyDetachedDeleted__:</td>
                    <td class="alteration-count-label">0</td>
                    <td>__MSG_packaging__ __MSG_errors__:</td>
                    <td class="packaging-error-count-label">0</td>
                </tr>
                <tr>
                    <td>__MSG_savedAttachments__:</td>
                    <td class="saved-attachment-count-label">0</td>
                    <td>__MSG_duplicateAttachments__:</td>
                    <td class="duplicate-attachment-count-label">0</td>
                    <td>__MSG_permanentDetachmentErrors__:</td>
                    <td class="deletion-error-count-label">0</td>
                </tr>
                <tr>
                    <td>__MSG_savedEmbeds__:</td>
                    <td class="saved-embed-count-label">0</td>
                    <td>__MSG_duplicateEmbeds__:</td>
                    <td class="duplicate-embed-count-label">0</td>
                    <td colspan="2">&nbsp;</td>
                </tr>
            </table>

            <div class="list-table attachment-table hidden">
                <h3>__MSG_savedAttachments__</h3>
            </div>

            <div class="list-table alteration-table hidden">
                <h3>__MSG_previouslyDetachedDeleted__ (__MSG_omitted__)</h3>
            </div>

            <div class="list-table duplicate-table hidden">
                <h3>__MSG_duplicateAttachments__ (__MSG_omitted__)</h3>
            </div>

            <div class="list-table embed-table hidden">
                <h3>__MSG_savedEmbeds__</h3>
            </div>

            <div class="list-table duplicate-embed-table hidden">
                <h3>__MSG_duplicateEmbeds__ (__MSG_omitted__)</h3>
            </div>

            <div class="list-table error-table hidden">
                <h3>__MSG_errors__</h3>
            </div>

            <div class="list-table detachment-error-table hidden">
                <h3>__MSG_permanentDetachmentErrors__</h3>
            </div>
        </div>                
    </template>

    <template id="report-item-template">
        <div class="list-table-item-container">
            <div class="sequence-number"></div>
            <div class="filename-label"></div>
            <div class="file-size-label"></div>

            <div class="author-label"></div>
            <div class="message-date-label"></div>

            <div class="subject-label"></div>
            <div class="message-time-label"></div>

            <div class="special-message-label hidden"></div>
        </div>        
    </template>

    <script src="/module/i18n.js"></script>
    <script src="/module/zip-full.js"></script>
    <script type="module" src="extractem.js"></script>
</body>
</html>